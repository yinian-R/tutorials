package com.wymm.geo;

import cn.hutool.core.util.CoordinateUtil;
import com.wymm.geo.utils.GeoUtils;
import lombok.SneakyThrows;
import org.geotools.referencing.crs.DefaultGeographicCRS;
import org.junit.jupiter.api.Test;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.Geometry;

/**
 * 格式转换
 */
public class _1FormatTest {
    
    @SneakyThrows
    @Test
    void wktToGeojson() {
        double v = GeoUtils.calculateDistance(23.2203570, 113.3667490, 23.2153570, 113.3667490, DefaultGeographicCRS.WGS84);
        System.out.println(v);
    }
    
    @SneakyThrows
    @Test
    void wktMultilinestringToGeojson() {
        String wkt = "MULTILINESTRING((113.36778581142426 22.918832302093506,113.36755514144897 22.918574810028076,113.36735129356384 22.918376326560974,113.367018699646 22.918108105659485,113.36692214012146 22.918027639389038,113.3663535118103 22.917587757110596,113.3662086725235 22.91748046875,113.3651465177536 22.91674017906189,113.36495876312256 22.916611433029175,113.36386978626251 22.915844321250916,113.362877368927 22.915152311325073,113.36206197738647 22.914589047431946,113.36162745952606 22.914304733276367,113.36149871349335 22.91421353816986,113.36128413677216 22.914041876792908,113.36083352565765 22.91371464729309,113.36018443107605 22.91324257850647,113.36002349853516 22.913129925727844,113.35925102233887 22.912582755088806,113.35893988609314 22.912357449531555,113.35883796215057 22.912287712097168,113.35863947868347 22.912158966064453,113.35750222206116 22.911343574523926,113.35693359375 22.910935878753662,113.3567351102829 22.910791039466858,113.3563381433487 22.91051208972931,113.35614502429962 22.910377979278564,113.35492730140686 22.90950894355774,113.3545196056366 22.9092139005661,113.35355401039124 22.90851652622223,113.35257232189178 22.907835245132446,113.35230946540833 22.907652854919434,113.35181057453156 22.90728271007538,113.35162818431854 22.907159328460693,113.35121512413025 22.906875014305115,113.35071086883545 22.90652096271515,113.35067331790924 22.906494140625,113.3498364686966 22.905909419059753,113.3493322134018 22.905544638633728,113.34928393363953 22.90550708770752,113.34839344024658 22.904857993125916,113.34803402423859 22.904616594314575,113.34715962409973 22.90396213531494,113.3471006155014 22.903919219970703,113.34393560886383 22.901607155799866,113.3423638343811 22.900437712669373,113.34102809429169 22.89946675300598,113.34046483039856 22.899091243743896,113.33997666835785 22.898823022842407,113.33939731121063 22.898554801940918,113.33912372589111 22.898426055908203,113.33893060684204 22.898334860801697,113.33882331848145 22.89828658103943,113.33799719810486 22.897868156433105,113.33635032176971 22.897074222564697,113.33575487136841 22.89677381515503,113.33532571792603 22.89653778076172,113.3349609375 22.896317839622498,113.33462834358215 22.896087169647217,113.33454251289368 22.89603352546692,113.3342957496643 22.895840406417847,113.33392024040222 22.8955078125,113.33388805389404 22.89548099040985,113.33345890045166 22.89502501487732,113.33302974700928 22.89452612400055,113.33286881446838 22.89429545402527,113.33239674568176 22.893463969230652,113.33233773708344 22.893351316452026,113.33186030387878 22.892444729804993,113.33144187927246 22.891645431518555,113.33124876022339 22.891312837600708,113.33103954792023 22.89100706577301,113.33082497119904 22.89072811603546,113.33053529262543 22.890395522117615,113.33030998706818 22.890175580978394,113.32987010478973 22.889810800552368,113.3295750617981 22.889601588249207,113.32930147647858 22.889424562454224,113.32901179790497 22.88926362991333,113.32852900028229 22.88904368877411,113.32799792289734 22.888850569725037,113.32769215106964 22.88875937461853,113.32733273506165 22.888684272766113,113.3270001411438 22.888630628585815,113.3266031742096 22.888576984405518,113.32597017288208 22.888571619987488,113.3256483078003 22.888582348823547,113.32490265369415 22.888673543930054,113.3241730928421 22.888866662979126,113.32360982894897 22.889075875282288,113.32314312458038 22.88928508758545,113.32261741161346 22.88951575756073,113.32054138183594 22.890443801879883,113.31808984279633 22.891586422920227,113.31721007823944 22.89199411869049,113.31511795520782 22.892965078353882,113.313889503479 22.893571257591248,113.31327795982361 22.893887758255005,113.31298828125 22.8940486907959,113.31251084804535 22.894316911697388,113.3115828037262 22.894858717918396,113.31099808216095 22.89522349834442,113.31055283546448 22.8955078125,113.31028461456299 22.895684838294983,113.3095121383667 22.896189093589783,113.3094584941864 22.89622664451599,113.30806374549866 22.897138595581055,113.30540299415588 22.898871302604675,113.30485582351685 22.899171710014343,113.30429792404175 22.899364829063416,113.30410480499268 22.899450659751892,113.30391705036163 22.899579405784607,113.3036595582962 22.899804711341858),(113.30233454704285 22.899434566497803,113.30223262310028 22.899150252342224,113.30215215682983 22.89901614189148,113.30207169055939 22.898903489112854,113.30162644386292 22.898372411727905,113.30143332481384 22.89799690246582,113.30136358737946 22.897841334342957,113.30122411251068 22.89747655391693,113.30111682415009 22.897117137908936,113.30104172229767 22.896827459335327,113.3009397983551 22.896414399147034,113.30069839954376 22.8955078125,113.30022633075714 22.89372682571411,113.30002784729004 22.8930401802063,113.29989910125732 22.892680764198303,113.29975962638855 22.892342805862427,113.29948604106903 22.891886830329895,113.29934656620026 22.891688346862793,113.29912662506104 22.891452312469482),(113.29912662506104 22.891452312469482,113.29882085323334 22.891157269477844,113.29848825931549 22.890905141830444,113.29840779304504 22.890856862068176,113.29817175865173 22.890695929527283,113.29788744449615 22.89055109024048,113.29745292663574 22.890379428863525,113.29684674739838 22.890191674232483,113.29642832279205 22.890073657035828,113.29610109329224 22.88997709751129,113.2951945066452 22.889708876609802,113.29443275928497 22.88949966430664,113.29406797885895 22.889387011528015,113.29310774803162 22.889097332954407,113.2920777797699 22.88878083229065,113.29178810119629 22.888678908348083,113.29140722751617 22.88851261138916,113.29105854034424 22.888324856758118,113.291015625 22.88829803466797,113.29061329364777 22.88801908493042,113.29026997089386 22.88772404193878,113.2900607585907 22.88749873638153,113.28972280025482 22.887096405029297,113.28910052776337 22.88629710674286,113.28853189945221 22.885567545890808))";
        Geometry geometry = GeoUtils.wktToGeometry(wkt);
        String geojson = GeoUtils.convertGeojsonString(geometry);
        System.out.println(geojson);
        
        String geojson1 = GeoUtils.wktToGeojson(wkt);
        System.out.println(geojson1);
        
        
        String wkt1 = GeoUtils.wktToFeatureCollectionJSON(wkt);
        System.out.println(wkt1);
        
        String wkt2 = GeoUtils.wktToFeatureJSON(wkt);
        System.out.println(wkt2);
        
        
    }
    
    /**
     * 转换经纬度
     */
    @SneakyThrows
    @Test
    void test2() {
        String wkt = "MULTILINESTRING((113.36778581142426 22.918832302093506,113.36755514144897 22.918574810028076,113.36735129356384 22.918376326560974,113.367018699646 22.918108105659485,113.36692214012146 22.918027639389038,113.3663535118103 22.917587757110596,113.3662086725235 22.91748046875,113.3651465177536 22.91674017906189,113.36495876312256 22.916611433029175,113.36386978626251 22.915844321250916,113.362877368927 22.915152311325073,113.36206197738647 22.914589047431946,113.36162745952606 22.914304733276367,113.36149871349335 22.91421353816986,113.36128413677216 22.914041876792908,113.36083352565765 22.91371464729309,113.36018443107605 22.91324257850647,113.36002349853516 22.913129925727844,113.35925102233887 22.912582755088806,113.35893988609314 22.912357449531555,113.35883796215057 22.912287712097168,113.35863947868347 22.912158966064453,113.35750222206116 22.911343574523926,113.35693359375 22.910935878753662,113.3567351102829 22.910791039466858,113.3563381433487 22.91051208972931,113.35614502429962 22.910377979278564,113.35492730140686 22.90950894355774,113.3545196056366 22.9092139005661,113.35355401039124 22.90851652622223,113.35257232189178 22.907835245132446,113.35230946540833 22.907652854919434,113.35181057453156 22.90728271007538,113.35162818431854 22.907159328460693,113.35121512413025 22.906875014305115,113.35071086883545 22.90652096271515,113.35067331790924 22.906494140625,113.3498364686966 22.905909419059753,113.3493322134018 22.905544638633728,113.34928393363953 22.90550708770752,113.34839344024658 22.904857993125916,113.34803402423859 22.904616594314575,113.34715962409973 22.90396213531494,113.3471006155014 22.903919219970703,113.34393560886383 22.901607155799866,113.3423638343811 22.900437712669373,113.34102809429169 22.89946675300598,113.34046483039856 22.899091243743896,113.33997666835785 22.898823022842407,113.33939731121063 22.898554801940918,113.33912372589111 22.898426055908203,113.33893060684204 22.898334860801697,113.33882331848145 22.89828658103943,113.33799719810486 22.897868156433105,113.33635032176971 22.897074222564697,113.33575487136841 22.89677381515503,113.33532571792603 22.89653778076172,113.3349609375 22.896317839622498,113.33462834358215 22.896087169647217,113.33454251289368 22.89603352546692,113.3342957496643 22.895840406417847,113.33392024040222 22.8955078125,113.33388805389404 22.89548099040985,113.33345890045166 22.89502501487732,113.33302974700928 22.89452612400055,113.33286881446838 22.89429545402527,113.33239674568176 22.893463969230652,113.33233773708344 22.893351316452026,113.33186030387878 22.892444729804993,113.33144187927246 22.891645431518555,113.33124876022339 22.891312837600708,113.33103954792023 22.89100706577301,113.33082497119904 22.89072811603546,113.33053529262543 22.890395522117615,113.33030998706818 22.890175580978394,113.32987010478973 22.889810800552368,113.3295750617981 22.889601588249207,113.32930147647858 22.889424562454224,113.32901179790497 22.88926362991333,113.32852900028229 22.88904368877411,113.32799792289734 22.888850569725037,113.32769215106964 22.88875937461853,113.32733273506165 22.888684272766113,113.3270001411438 22.888630628585815,113.3266031742096 22.888576984405518,113.32597017288208 22.888571619987488,113.3256483078003 22.888582348823547,113.32490265369415 22.888673543930054,113.3241730928421 22.888866662979126,113.32360982894897 22.889075875282288,113.32314312458038 22.88928508758545,113.32261741161346 22.88951575756073,113.32054138183594 22.890443801879883,113.31808984279633 22.891586422920227,113.31721007823944 22.89199411869049,113.31511795520782 22.892965078353882,113.313889503479 22.893571257591248,113.31327795982361 22.893887758255005,113.31298828125 22.8940486907959,113.31251084804535 22.894316911697388,113.3115828037262 22.894858717918396,113.31099808216095 22.89522349834442,113.31055283546448 22.8955078125,113.31028461456299 22.895684838294983,113.3095121383667 22.896189093589783,113.3094584941864 22.89622664451599,113.30806374549866 22.897138595581055,113.30540299415588 22.898871302604675,113.30485582351685 22.899171710014343,113.30429792404175 22.899364829063416,113.30410480499268 22.899450659751892,113.30391705036163 22.899579405784607,113.3036595582962 22.899804711341858),(113.30233454704285 22.899434566497803,113.30223262310028 22.899150252342224,113.30215215682983 22.89901614189148,113.30207169055939 22.898903489112854,113.30162644386292 22.898372411727905,113.30143332481384 22.89799690246582,113.30136358737946 22.897841334342957,113.30122411251068 22.89747655391693,113.30111682415009 22.897117137908936,113.30104172229767 22.896827459335327,113.3009397983551 22.896414399147034,113.30069839954376 22.8955078125,113.30022633075714 22.89372682571411,113.30002784729004 22.8930401802063,113.29989910125732 22.892680764198303,113.29975962638855 22.892342805862427,113.29948604106903 22.891886830329895,113.29934656620026 22.891688346862793,113.29912662506104 22.891452312469482),(113.29912662506104 22.891452312469482,113.29882085323334 22.891157269477844,113.29848825931549 22.890905141830444,113.29840779304504 22.890856862068176,113.29817175865173 22.890695929527283,113.29788744449615 22.89055109024048,113.29745292663574 22.890379428863525,113.29684674739838 22.890191674232483,113.29642832279205 22.890073657035828,113.29610109329224 22.88997709751129,113.2951945066452 22.889708876609802,113.29443275928497 22.88949966430664,113.29406797885895 22.889387011528015,113.29310774803162 22.889097332954407,113.2920777797699 22.88878083229065,113.29178810119629 22.888678908348083,113.29140722751617 22.88851261138916,113.29105854034424 22.888324856758118,113.291015625 22.88829803466797,113.29061329364777 22.88801908493042,113.29026997089386 22.88772404193878,113.2900607585907 22.88749873638153,113.28972280025482 22.887096405029297,113.28910052776337 22.88629710674286,113.28853189945221 22.885567545890808))";
        Geometry geometry = GeoUtils.wktToGeometry(wkt);
        System.out.println(geometry.toText());
        System.out.println(GeoUtils.wktToGeojson(wkt));
        
        for (int i = 0; i < geometry.getNumGeometries(); i++) {
            Geometry line = geometry.getGeometryN(i);
            Coordinate[] coords = line.getCoordinates();
            for (Coordinate coordinate : coords) {
                // 高德转84
                CoordinateUtil.Coordinate coordinate2 = CoordinateUtil.gcj02ToWgs84(coordinate.getX(), coordinate.getY());
                
                //if (GZ2000.equals(targetCRS)){
                //    // 84 转 GZ2000
                //    coordinate2 = wgs84ToGz2000( coordinate2.getLng(), coordinate2.getLat());
                //}
                
                coordinate.setX(coordinate2.getLng());
                coordinate.setY(coordinate2.getLat());
            }
        }
        
        System.out.println(geometry.toText());
        System.out.println(GeoUtils.wktToGeojson(geometry.toText()));
    }
    
    /**
     *  [vv.geometry.coordinates[0] - 0.0107, vv.geometry.coordinates[1] - 0.006]
     * @param lng
     * @param lat
     * @return
     */
    public static final CoordinateUtil.Coordinate wgs84ToGz2000(double lng, double lat) {
        double lngTemp = lng - 0.0107;
        double latTemp = lat - 0.006;
        return new CoordinateUtil.Coordinate(lngTemp, latTemp);
    }
}
