package com.wymm.geo;

import cn.hutool.core.util.CoordinateUtil;
import com.wymm.geo.utils.transform.CoordinateTransform;
import com.wymm.geo.utils.transform.CoordinateTransformationEnum;
import com.wymm.geo.utils.transform.CoordinateTransformer;
import com.wymm.geo.utils.GeoUtils;
import org.junit.jupiter.api.Test;
import org.locationtech.jts.geom.Coordinate;
import org.locationtech.jts.geom.Geometry;
import org.locationtech.jts.geom.util.GeometryTransformer;

/**
 * 转换经纬度
 */
public class _3TransformCoordinateTest {
    
    @Test
    void test1() {
        CoordinateTransform wgs84ToWebMercator = coord -> {
            CoordinateUtil.Coordinate tempCoor = CoordinateUtil.gcj02ToWgs84(coord.getX(), coord.getY());
            return new Coordinate(tempCoor.getLng(), tempCoor.getLat());
        };
        
        // 创建转换器
        GeometryTransformer transformer = new CoordinateTransformer(wgs84ToWebMercator);
        
        // 转换几何体
        String wkt = "POLYGON((113.407008 23.14432,113.40769 23.144276,113.408185 23.144168,113.408749 23.144017,113.409196 23.1438,113.41002 23.143324,113.41042 23.143022,113.41082 23.142719,113.411338 23.14207,113.411573 23.14155,113.411667 23.141118,113.411761 23.140555,113.411761 23.139949,113.411714 23.139257,113.411643 23.138889,113.411502 23.138478,113.411408 23.138132,113.411385 23.137633,113.411479 23.137438,113.411808 23.137114,113.41209 23.137005,113.412561 23.136962,113.41289 23.13694,113.413102 23.136897,113.412938 23.136767,113.412726 23.136638,113.41242 23.1364,113.411926 23.135967,113.411808 23.135815,113.411667 23.135556,113.411667 23.135318,113.41162 23.134907,113.41162 23.13389,113.411526 23.13337,113.41122 23.133111,113.410938 23.133067,113.41009 23.133024,113.408514 23.133067,113.40809 23.133024,113.407714 23.133067,113.407479 23.133111,113.40729 23.133197,113.407149 23.1335,113.407126 23.133587,113.407008 23.14432))" ;
        Geometry originalGeometry = GeoUtils.convertWktToGeometry(wkt);
        Geometry transformedGeometry = transformer.transform(originalGeometry);
        System.out.println(transformedGeometry.toText());
    }
    
    @Test
    void test2() {
        // 创建转换器
        GeometryTransformer transformer = new CoordinateTransformer(CoordinateTransformationEnum.GCJ02_TO_WGS84);
        
        // 转换几何体
        String wkt = "POLYGON((113.407008 23.14432,113.40769 23.144276,113.408185 23.144168,113.408749 23.144017,113.409196 23.1438,113.41002 23.143324,113.41042 23.143022,113.41082 23.142719,113.411338 23.14207,113.411573 23.14155,113.411667 23.141118,113.411761 23.140555,113.411761 23.139949,113.411714 23.139257,113.411643 23.138889,113.411502 23.138478,113.411408 23.138132,113.411385 23.137633,113.411479 23.137438,113.411808 23.137114,113.41209 23.137005,113.412561 23.136962,113.41289 23.13694,113.413102 23.136897,113.412938 23.136767,113.412726 23.136638,113.41242 23.1364,113.411926 23.135967,113.411808 23.135815,113.411667 23.135556,113.411667 23.135318,113.41162 23.134907,113.41162 23.13389,113.411526 23.13337,113.41122 23.133111,113.410938 23.133067,113.41009 23.133024,113.408514 23.133067,113.40809 23.133024,113.407714 23.133067,113.407479 23.133111,113.40729 23.133197,113.407149 23.1335,113.407126 23.133587,113.407008 23.14432))" ;
        Geometry originalGeometry = GeoUtils.convertWktToGeometry(wkt);
        Geometry transformedGeometry = transformer.transform(originalGeometry);
        System.out.println(transformedGeometry.toText());
    }
    
    @Test
    void test3() {
        // 转换几何体
        String wkt = "POLYGON((113.407008 23.14432,113.40769 23.144276,113.408185 23.144168,113.408749 23.144017,113.409196 23.1438,113.41002 23.143324,113.41042 23.143022,113.41082 23.142719,113.411338 23.14207,113.411573 23.14155,113.411667 23.141118,113.411761 23.140555,113.411761 23.139949,113.411714 23.139257,113.411643 23.138889,113.411502 23.138478,113.411408 23.138132,113.411385 23.137633,113.411479 23.137438,113.411808 23.137114,113.41209 23.137005,113.412561 23.136962,113.41289 23.13694,113.413102 23.136897,113.412938 23.136767,113.412726 23.136638,113.41242 23.1364,113.411926 23.135967,113.411808 23.135815,113.411667 23.135556,113.411667 23.135318,113.41162 23.134907,113.41162 23.13389,113.411526 23.13337,113.41122 23.133111,113.410938 23.133067,113.41009 23.133024,113.408514 23.133067,113.40809 23.133024,113.407714 23.133067,113.407479 23.133111,113.40729 23.133197,113.407149 23.1335,113.407126 23.133587,113.407008 23.14432))" ;
        Geometry originalGeometry = GeoUtils.convertWktToGeometry(wkt);
        Geometry transformedGeometry = GeoUtils.transform(originalGeometry, CoordinateTransformationEnum.GCJ02_TO_WGS84);
        System.out.println(transformedGeometry.toText());
    }

    
}
